<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Gulp | Fullstack Development w/ Javascript]]></title>
  <link href="http://www.eguneys.com/blog/categories/gulp/atom.xml" rel="self"/>
  <link href="http://www.eguneys.com/"/>
  <updated>2016-06-02T18:00:25+03:00</updated>
  <id>http://www.eguneys.com/</id>
  <author>
    <name><![CDATA[Emre Guneyler]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Gulp Workflow for Building Web Projects]]></title>
    <link href="http://www.eguneys.com/blog/2016/06/02/gulp-workflow-for-building-web-projects/"/>
    <updated>2016-06-02T17:51:35+03:00</updated>
    <id>http://www.eguneys.com/blog/2016/06/02/gulp-workflow-for-building-web-projects</id>
    <content type="html"><![CDATA[<p>Gulp Workflow For Building Web Projects</p>

<p>In this quick tip, we will build a simple and fast gulp workflow for building web projects.</p>

<p>If you are building a small web project, or testing an idea, and you just want to quickly get up and running, you will find gulp useful to help you handle your workflow tasks.</p>

<p>You can also check out the example <a href="https://github.com/eguneys/gulpp">github repo</a>.</p>

<h2>Gulp Tasks</h2>

<p>This is a list of essential gulp tasks we will setup:</p>

<p>Development
* Linting
* Bundle ES6/JavaScript with source maps
* Watch JavaScript and bundle on changes</p>

<p>Production
* Bundle and minify ES6/JavaScript
* Minify CSS
* Copy files</p>

<p>For development, we need to bundle ES6 code for the browser, and include source maps, so we can easily debug it in the browser. We also watch source files for changes and re-bundle so we can quickly see the result of our changes. Optionally, we lint our code, so it helps detect errors in our code, we add it because it&rsquo;s simple.</p>

<p>For production, again we bundle ES6 code for the browser, this time, we minify it. We also minify our CSS. Finally, we copy other assets to our build folder.</p>

<p>This is the simplest setup we need to get things working. Use <code>http-server</code> to serve our project for development, and reload browser manually when the code changes, so we don&rsquo;t have to complicate our setup to handle these jobs.</p>

<pre><code class="bash">npm install http-server -g
</code></pre>

<h2>Setting Up The Project</h2>

<p>Setup the file structure, and initialize our Node.js project, it will add a <code>package.json</code> to our project.</p>

<pre><code class="bash">mkdir examples assets src
npm init
</code></pre>

<h3>Development</h3>

<p>Install <a href="https://www.sitepoint.com/beginners-guide-node-package-manager/">npm</a> dependencies for development:</p>

<pre><code class="bash">npm install --save-dev gulp gulp-util gulp-streamify gulp-jshint jshint gulp-uglify vinyl-source-stream watchify babelify babel-preset-es2015 babel-plugin-add-module-exports gulp-csso
</code></pre>

<p>We have <code>gulp</code> and some gulp plugins to handle gulp tasks. <code>babelify</code> is <a href="https://github.com/substack/node-browserify#browserifytransform">browserify transform</a> to transform ES6 code with <a href="https://babeljs.io/">babel</a> and bundle it for the browser. <code>babel</code> needs some plugins to work properly, so we include them as well. <code>watchify</code> is <a href="https://github.com/substack/node-browserify#plugins">browserify plugin</a> for watching source files, and re-bundle on code changes. and <code>vinyl-source-stream</code> is for gluing <code>browserify</code> with <code>gulp</code>.</p>

<p>Now add an <code>examples/index.html</code> file to test our project:</p>

<pre><code class="html">&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Gulp workflow for setting up a web project&lt;/title&gt;
    &lt;link rel="stylesheet" href="../build/main.css"&gt;
    &lt;script src="../build/gulpp.js"&gt;&lt;/script&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div id="gulpp"&gt;&lt;/div&gt;
    &lt;script&gt;
      (function() {
        var ground = Gulpp(document.getElementById('gulpp'));
      })();
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>In the head section, we reference a CSS file and a JavaScript file from the <code>build</code> folder. This folder and the files will be created by our build workflow. In the body section, we have a single div element <code>#gulpp</code>. Finally inside the <code>script</code> block we have a <a href="https://www.sitepoint.com/community/t/understanding-anonymous-functions/41542/10">self invoking function</a>. Our code is exposed with the <code>Gulpp</code> global name, we will see later how this is done. We can use it inside this function to test our code, we call it as a function and pass the <code>#gulpp</code> DOM element, so that our app will hopefully render into it.</p>

<p>Run <code>http-server</code> to serve our project folder, and visit <code>http://localhost:8080/examples/index.html</code>.</p>

<p>There are three errors, we need to build CSS and JavaScript and put them in the <code>build</code> folder:</p>

<pre><code>Cannot GET http://localhost:8080/build/main.css
Cannot GET http://localhost:8080/build/gulpp.js
Uncaught ReferenceError: Gulpp is not defined
</code></pre>

<p>Add a <code>gulpfile.js</code> file in the root of our project to define gulp tasks:</p>

<pre><code class="js">var source = require('vinyl-source-stream');
var gulp = require('gulp');
var gutil = require('gulp-util');
var jshint = require('gulp-jshint');
var watchify = require('watchify');
var browserify = require('browserify');
var uglify = require('gulp-uglify');
var streamify = require('gulp-streamify');

var sources = ['./src/main.js'];
var destination = './build';
var onError = function(error) {
  gutil.log(gutil.colors.red(error.message));
};

var standalone = 'Gulpp';

gulp.task('dev', function() {
  var opts = watchify.args;
  opts.debug = true;
  opts.standalone = standalone;
  var bundleStream = watchify(browserify(sources, opts))
      .transform('babelify',
                 { presets: ["es2015"],
                   plugins: ['add-module-exports'] })
      .on('update', rebundle)
      .on('log', gutil.log);

  function rebundle() {
    return bundleStream.bundle()
      .on('error', onError)
      .pipe(source('gulpp.js'))
      .pipe(gulp.dest(destination));
  }

  return rebundle();
});

gulp.task('default', ['dev']);
</code></pre>

<p>First, we require our dependencies, next we define where our source files are and our destination folder, where our bundled project is put.</p>

<p>Then we define our <code>dev</code> task. <code>browserify</code> will take our source files, and bundle them into a single file. <code>debug</code> option is for generating source maps and <code>standalone</code> option will export the code as a window global. <code>babelify</code> will transform ES6 before bundling. <code>watchify</code> will emit <code>update</code> event when the files change, and <code>log</code> event when the bundle is created.</p>

<p>We define a <code>rebundle</code> function to do the actual bundling and call it on <code>update</code> event so it will re-bundle on source changes. After calling <code>bundle</code> on the browserify instance, it will produce a single JavaScript file. Next, we add <code>vinyl-source-stream</code> passing a filename <code>gulpp.js</code> in to the mix to <a href="http://stackoverflow.com/a/30851219/3995789">make it more gulp friendly</a>, and finally write it inside <code>./build</code> folder. See <a href="https://www.sitepoint.com/getting-started-browserify/">this article</a> for a more detailed explanation of how this works. Also notice that we added handlers for the <code>log</code> and <code>error</code> events, so the bundle errors and logs can be logged.</p>

<p>We define <code>dev</code> task as the <code>default</code> task for gulp. So run <code>gulp</code> to test if our gulp task is working:</p>

<pre><code class="bash">[11:41:37] Cannot find module '/projects/gulpp/src/main.js' from '/projects/gulpp'
</code></pre>

<p>It&rsquo;s working, but we need to add a JavaScript source file to bundle.</p>

<p>Add a <code>src/main.js</code> file to define our application starting point:</p>

<pre><code class="js">import view from './view';

const ctrl = {
  data: {
    face: 'cats',
    msg: '[gulpp]'
  }
};

function render(element, obj) {
  var tag = obj.tag;
  var body = obj.children;
  element.innerHTML = `&lt;${tag}&gt;${body}&lt;/${tag}&gt;`;
}

function init(element, config = {}) {
  var msg = config.msg || "[gulpp]";

  ctrl.data.msg = msg;

  ctrl.data.render = () =&gt; {
    render(element, view(ctrl));
  };
  ctrl.data.renderRAF = function() {
    window.requestAnimationFrame(ctrl.data.render);
  };
  ctrl.data.render();
}

module.exports = init;
</code></pre>

<p><code>src/main.js</code> imports <code>./view</code> module, So add a <code>src/view.js</code> file to define it.</p>

<pre><code class="js">module.exports = function(ctrl) {
  var data = ctrl.data;
  return {
    tag: 'p',
    children: `${data.msg} is alive! &lt;br/&gt; &lt;span class="cat"&gt;${data.face}&lt;/span&gt; `
  };
};
</code></pre>

<p>To simply describe our code, we set up an MVC style project. <code>./view</code> module takes the <code>ctrl.data</code> and returns a data structure so we can render it. <code>./main</code> module sets up the <code>ctrl.data</code> and gives it to <code>render</code> function, so it renders it to DOM. Remember the <code>Gulpp</code> global variable inside our HTML file, we called is as a function and passed a DOM element. It is what we export from inside <code>src/main.js</code>, in this case the <code>init</code> function.</p>

<p>If we want to add an external dependency, first we install it:</p>

<pre><code class="bash">npm install --save cat-ascii-faces
</code></pre>

<p>Then import and use it (inside <code>src/main.js</code>):</p>

<pre><code class="js">import cats from 'cat-ascii-faces';

setInterval(() =&gt; {
  ctrl.data.face = cats();
  ctrl.data.renderRAF();
}, 1000 + (Math.random() * 4000));
</code></pre>

<p>This will update our <code>ctrl.data</code> and re-render our app.</p>

<p>Run gulp <code>dev</code> task if it&rsquo;s not already running, and refresh the browser to see the code working. We can see the ES6 source files and set breakpoints on browser:</p>

<p><img class="<a" src="href="https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/05/1464275958gulp-workflow-sourcemap.png">https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/05/1464275958gulp-workflow-sourcemap.png</a>&#8221; title=&#8221;[gulp workflow source-map breakpoint]&#8221; ></p>

<p>If we want to serve assets like stylesheets or images, we can copy these files into build folder using a gulp task:</p>

<pre><code class="js">gulp.task('assets', function() {
  var assetFiles = './assets/**/*';
  var path = require('path');
  gulp.src(assetFiles)
    .pipe(gulp.dest(path.join(destination)));
});
</code></pre>

<p>We can hook this task to <code>dev</code> task so it will run every time we run <code>dev</code> task. Change our <code>dev</code> task:</p>

<pre><code class="bash">-gulp.task('dev', function() {
+gulp.task('dev', ['assets'], function() {
</code></pre>

<p>Finally, add a gulp task to lint our JavaScript:</p>

<pre><code class="js">gulp.task('lint', function() {
  return gulp.src(sources)
    .pipe(jshint({ esversion: 6 }))
    .pipe(jshint.reporter('default'));
});
</code></pre>

<p>Note the <code>esversion: 6</code> option we pass to <code>jshint</code> so it works with ES6. All setup for development. Write some code and reload the browser to see the changes.</p>

<h3>Production</h3>

<p>We need to minify code for production use.</p>

<p>First, add a task to minify CSS:</p>

<pre><code class="js">gulp.task('css', function() {
  var cssFiles = 'assets/*.css';

  return gulp.src(cssFiles)
    .pipe(csso())
    .pipe(gulp.dest(destination));
});
</code></pre>

<p>Add some CSS files in <code>assets</code> folder, then run <code>gulp css</code> to run this task, and see the minified output in <code>build/main.css</code>.</p>

<p>Next, add a task to minify JavaScript:</p>

<pre><code class="js">gulp.task('prod', ['css'], function() {
  return browserify(sources, {
    standalone: standalone
  }).transform('babelify',
               { presets: ["es2015"],
                 plugins: ['add-module-exports'] })
    .bundle()
    .on('error', onError)
    .pipe(source('gulpp.min.js'))
    .pipe(streamify(uglify()))
    .pipe(gulp.dest(destination));
});
</code></pre>

<p>This task is similar to our <code>dev</code> task, except we don&rsquo;t have the <code>debug</code> option, and we have an extra step for minifying code, using <code>gulp-uglify</code> and we have to wrap that with <code>gulp-streamify</code>, see <a href="http://stackoverflow.com/a/26127463/3995789">why here</a>. Finally since the output is minified, we change our output filename to <code>gulpp.min.js</code>.</p>

<p>We are done with our gulp tasks. Add a <a href="https://docs.npmjs.com/misc/scripts">script</a> to <code>package.json</code> to clean build folder and compile your project into it.</p>

<pre><code class="json">  "scripts": {
    "compile": "rm -rf build &amp;&amp; gulp prod"
  },
</code></pre>

<p>Now run <code>npm run compile</code> and check out our bundled project inside <code>build</code> folder.</p>

<h2>Publish</h2>

<p>Next step is to include this project inside another project, which we will call our main project. Although we can publish this to npm, we can also specify this project as a local dependency and use it locally.</p>

<p>Add <a href="https://docs.npmjs.com/files/package.json#main">main entry point</a> to <code>package.json</code>. This is the output JavaScript file from your <code>gulp prod</code> task:</p>

<pre><code class="json">  "main": "build/gulpp.min.js",
</code></pre>

<p>Run <code>npm link</code> in this project to specify it as a local module.</p>

<p>Next, go to our main project and install this project, when first time installing make sure you specify the local path to this project:</p>

<pre><code>npm install ../gulpp --save
</code></pre>

<p>Now you can import and use <a href="https://github.com/eguneys/gulpp">gulpp</a>. Next time we update something on this project, we have to run <code>npm run compile</code> to re-build our project, and go to our main project and run <code>npm install gulpp</code> to re-install the updated version. Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Let's Build a Yeoman Generator: Project Template /w Gulp]]></title>
    <link href="http://www.eguneys.com/blog/2014/09/17/lets-build-a-yeoman-generator-project-template-slash-w-gulp/"/>
    <updated>2014-09-17T12:14:32+03:00</updated>
    <id>http://www.eguneys.com/blog/2014/09/17/lets-build-a-yeoman-generator-project-template-slash-w-gulp</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p><a href="http://yeoman.io">Yeoman</a> is a project scaffolding tool, it defines your work-flow, and scaffolds the boilerplate. <a href="http://gulpjs.com">Gulp</a> is a build system, alternative to grunt, it is stream based, and prefers code over configuration.</p>

<p>In this two series articles we will learn how to build a yeoman generator from scratch, using test driven development. for Phaser game projects, which I before introduced in my previous article. We will use gulp as our build tool and requirejs for module loader.</p>

<p>First step towards a yeoman generator, is building a project template. yeoman is only responsible for scaffolding. The rest is building the project with gulp and having a project template. In this article we will build our project template using gulp and requirejs, in the next article we will introduce yeoman, and start test driven development.</p>

<h2>Initialize Phaser Game Project</h2>

<p>The Phaser is a game framework that runs on browser, as we develop our game, we will run the game on the browser and live reload the changes. We will use npm for our development dependencies, and bower for the front end dependencies.</p>

<p>First we initialize npm.</p>

<p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm init</code></pre></div></p>

<p>This will ask various questions and create a <code>package.json</code> file for us.</p>

<p>Next we initialize bower the same way, and create a <code>bower.json</code> file.
<div class="highlight"><pre><code class="language-bash" data-lang="bash">bower init</code></pre></div></p>

<h2>Decide a directory structure</h2>

<p>The next step is to decide a directory structure for the project.</p>

<p><div class="highlight"><pre><code class="language-bash" data-lang="bash">.
<span class="p">|&amp;</span>ndash<span class="p">;</span> app
<span class="p">|</span>   <span class="p">|&amp;</span>ndash<span class="p">;</span> data
<span class="p">|</span>   <span class="p">|&amp;</span>ndash<span class="p">;</span> index.html
<span class="p">|</span>   &lt;code&gt;-- scripts
<span class="p">|</span>       <span class="p">|</span>-- app.js
<span class="p">|</span>       <span class="p">|</span>-- common.js
<span class="p">|</span>       <span class="p">|</span>-- config.js
<span class="p">|</span>       <span class="p">|</span>-- lib_main.js
<span class="p">|</span>       <span class="p">|</span>-- main.js
<span class="p">|</span>       <span class="p">|</span>-- prefabs
<span class="p">|</span>      &lt;/code&gt;<span class="p">&amp;</span>ndash<span class="p">;</span> states
<span class="p">|</span>           <span class="p">|&amp;</span>ndash<span class="p">;</span> boot.js
<span class="p">|</span>           &lt;code&gt;-- preload.js
<span class="p">|</span>-- bower.json
<span class="p">|</span>-- build
<span class="p">|</span>   <span class="p">|</span>-- wrap.end
<span class="p">|</span>  &lt;/code&gt;<span class="p">&amp;</span>ndash<span class="p">;</span> wrap.start
<span class="p">|&amp;</span>ndash<span class="p">;</span> gulpfile.js
<span class="sb">`</span><span class="p">&amp;</span>ndash<span class="p">;</span> package.json&lt;/p&gt;

&lt;p&gt;</code></pre></div></p>

<p><code>app</code> folder is where our application code resides. <code>build</code> folder is for files used by requirejs optimizer. We have our <code>package.json</code>, <code>bower.json</code> and <code>gulpfile.js</code>. The project will compile into <code>public</code> directory as we will see later.</p>

<h3>Configure bower and jshint</h3>

<p>npm will install it&rsquo;s dependencies in the <code>node_modules</code> folder, and bower will install it&rsquo;s dependencies in the <code>bower_components</code> folder, but, yet we can configure the default directory for bower using a <code>.bowerrc</code></p>

<p>Create a <code>.bowerrc</code> file and add these in.</p>

<p><code>File: .bowerrc</code></p>

<p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">{</span>
  <span class="p">&amp;</span>ldquo<span class="p">;</span>directory<span class="p">&amp;</span>rdquo<span class="p">;</span>: <span class="p">&amp;</span>ldquo<span class="p">;</span>app/bower_components<span class="p">&amp;</span>rdquo<span class="p">;</span>
<span class="o">}</span></code></pre></div></p>

<p>Next, create a <code>.jshintrc</code> file. and setup your configuration.</p>

<p>Finally install the bower dependencies and save them in the <code>bower.json</code>.</p>

<p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bower install requirejs almond phaser <span class="p">&amp;</span>ndash<span class="p">;</span>save</code></pre></div></p>

<p>Note we use <code>--save</code> flag to make our changes saved in <code>bower.json</code>. We have three dependencies, requirejs the module loader, almond that we discussed in the previous article about requirejs, and Phaser the game framework.</p>

<h2>gulp.js, The streaming build system</h2>

<p>We have three types of tasks that gulp can help us for our project. Building the project, linting, and injecting code to our project, that is injecting our bower dependencies to our requirejs configuration file, and serving the project and watching for changes.</p>

<p>We will use gulp plugins and other npm modules to help us, the first plugin we use is <code>gulp-load-plugins</code>, that automatically loads any gulp plugins we have in our <code>package.json</code>, that is convenient.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">gulp</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
<span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">gulp</span><span class="o">-</span><span class="nx">load</span><span class="o">-</span><span class="nx">plugins</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;)();</span>
<span class="kd">var</span> <span class="nx">rimraf</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">rimraf</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
<span class="kd">var</span> <span class="nx">runSequence</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">run</span><span class="o">-</span><span class="nx">sequence</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span></code></pre></div></p>

<p>Note that we assign <code>gulp-load-plugins</code> to <code>$</code>, that is all the plugins are attached to. We also require two other npm modules, <code>rimraf</code> for removing files/folders, and <code>runSequence</code> for running gulp tasks in sync. Because gulp runs tasks asynchronously by default.</p>

<h3>gulp; build the project!</h3>

<p>First task is simple, <code>clean</code>, that will remove the build folder.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">clean</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">rimraf</span><span class="p">(</span><span class="nx">paths</span><span class="p">.</span><span class="nx">dist</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">});</span></code></pre></div></p>

<p>This is how you define a gulp task. notice we pass <code>cb</code> as a parameter, that makes the gulp task asynchronous. It will be called once the task is done and tell gulp to continue with the other tasks. By default gulp will run all the tasks and wait for nothing.</p>

<p>Next task is building the extra files in the <code>app</code> directory. In our case it&rsquo;s <code>index.html</code>, you might have extra <code>favicon.ico</code> or <code>robots.txt</code>.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">build</span><span class="o">-</span><span class="nx">extras</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/em&gt;&amp;rsquo;)</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="kr">public</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span>
<span class="p">});</span></code></pre></div></p>

<p><code>gulp.src</code> takes a glob and represents a file structure, which then can be piped to plugins. <code>gulp.dest</code> can be piped to and it will write files. In our case we take all the files in app folder, <code>app/*.*</code>, and write them into <code>public</code> folder.</p>

<p>Next task is building the scripts. In our case this is moving the scripts into the <code>public</code> directory. We might have used minification, optimization and concatenation, we don&rsquo;t need it. We have an extra task that uses requirejs optimizer to optimize the script files and build a stand-alone code you can check out the <a href="https://github.com/eguneys/phaser-gulp-requirejs">source code</a> for this article.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">build</span><span class="o">-</span><span class="nx">commonjs</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mergeStream</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">merge</span><span class="o">-</span><span class="nx">stream</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span><span class="o">&lt;</span><span class="err">/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="kd">var</span> <span class="nx">bowers</span> <span class="o">=</span> <span class="nx">gulp</span>
      <span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/</span><span class="nx">bower_components</span><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;*</span><span class="err">/&lt;/em&gt;.js&amp;rsquo;])</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">changed</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="kr">public</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">lib</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;))</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="kr">public</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">lib</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span><span class="o">&lt;</span><span class="err">/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="kd">var</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;*</span><span class="err">/&lt;/em&gt;.js&amp;rsquo;])</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">changed</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="kr">public</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">app</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;))</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="kr">public</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">app</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span><span class="o">&lt;</span><span class="err">/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="nx">mergeStream</span><span class="p">([</span><span class="nx">bowers</span><span class="p">,</span> <span class="nx">common</span><span class="p">]);</span>
<span class="p">});</span></code></pre></div></p>

<p>Note that, we use <code>merge-stream</code> that combines two gulp streams together, and we return the stream. Remember we passed an extra parameter, <code>cb</code> to gulp that made the task asynchronous, this is a second way of doing that, returning the stream also makes the task run asynchronous. The third way of making a task asynchronous is to return a promise. For more information about gulp API see <a href="https://github.com/gulpjs/gulp/blob/master/docs/API.md">docs</a>.</p>

<p>Finally we have our <code>build</code> task, that will run the <code>clean</code>, <code>jshint-fail</code>, and <code>build-requirejs</code> tasks synchronously in that order.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">build</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">runSequence</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">clean</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">jshint</span><span class="o">-</span><span class="nx">fail</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">build</span><span class="o">-</span><span class="nx">commonjs</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">});</span><span class="o">&lt;</span><span class="err">/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="k">default</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">build</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span></code></pre></div></p>

<p>Note that, we also have a special <code>default</code> task, that will run with only <code>gulp</code> command, opposed to <code>gulp build</code>.</p>

<p>By default, tasks are run concurrently, as opposed to grunt which runs the tasks in series. To run a list of tasks in sync either tasks have to be asynchronous and have to depend on each other or you need to run tasks via <code>runSequence</code>.</p>

<h3>gulp; lint, and inject some code!</h3>

<p>Next task, is linting our code with <code>jshint</code>, there is a gulp plugin we access it using <code>$.jshint</code>, remember <code>gulp-load-plugins</code>.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">jshint</span><span class="o">-</span><span class="nx">fail</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">gulpfile</span><span class="p">.</span><span class="nx">js</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span>
    <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="err">/*.js&amp;rsquo;,</span>
    <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">!</span><span class="nx">app</span><span class="o">/</span><span class="nx">bower_components</span><span class="o">/&lt;</span><span class="err">/strong&gt;&amp;rsquo;])</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">jshint</span><span class="p">())</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">jshint</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">jshint</span><span class="o">-</span><span class="nx">stylish</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">jshint</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">fail</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span>
  <span class="p">});</span></code></pre></div></p>

<p>Note that we pipe the jshint plugin and the jshint reporters to the gulp stream. Visit <a href="https://github.com/yeoman/bower-requirejs">here</a> for more information on jshint plugin.</p>

<p>There is an npm module <a href="https://github.com/yeoman/bower-requirejs">bower-requirejs</a>, that wires up installed bower components into requirejs config, we also use it in our gulp task, though I won&rsquo;t show it here.</p>

<h3>gulp; serve and watch files!</h3>

<p>Next task, is serving our project to the browser, we use <a href="https://github.com/schickling/gulp-webserver">gulp-webserver</a> plugin for that. It will start a connect server and serve our files as well as watch them and run a live reload server and inject a live reload script so the browser will auto refresh when a file is changed.</p>

<p>Final task is <code>watch</code> task, that will watch our source files for changes and run various tasks on change.</p>

<p><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">watch</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">serve</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;*</span><span class="err">/&lt;/em&gt;.js&amp;rsquo;, [&amp;lsquo;build-commonjs&amp;rsquo;]);&lt;/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">app</span><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/em&gt;&amp;rsquo;, [&amp;lsquo;build-extras&amp;rsquo;]);&lt;/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">bower</span><span class="p">.</span><span class="nx">json</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">bower</span><span class="o">-</span><span class="nx">rjs</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span><span class="o">&lt;</span><span class="err">/p&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">gulpfile</span><span class="p">.</span><span class="nx">js</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="err">\</span><span class="nx">n</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">-&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">+</span>
                                  <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="err">\</span><span class="nx">nRestart</span> <span class="nx">the</span> <span class="nx">Gulp</span> <span class="nx">process</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">+</span>
                                  <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="err">\</span><span class="nx">n</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">mdash</span><span class="p">;</span><span class="o">-&amp;</span><span class="nx">rsquo</span><span class="p">;));</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div></p>

<p>You might wonder, <code>gulp-webserver</code> is also watching the folders, why we need gulp to watch again. Well gulp watches the source files, and runs tasks that compiles the source into the <code>public</code> folder, meanwhile <code>gulp-webserver</code> watches the <code>public</code> folder for changes, and refreshes the browser on change.</p>

<p>Also note that &lsquo;watch&rsquo; task depends on &lsquo;serve&rsquo; task, we tell that by passing a dependency array as the second argument to <code>gulp.task</code>.</p>

<p>Here are the list of dependencies we&rsquo;ve used in this article and the command to install and save them in the <code>package.json</code>.</p>

<p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install <span class="p">&amp;</span>ndash<span class="p">;</span>save-dev gulp gulp-load-plugins gulp-changed gulp-imagemin gulp-livereload gulp-webserver gulp-util gulp-jshint jshint-stylish rimraf merge-stream run-sequence bower-requirejs requirejs</code></pre></div></p>

<p>There are many gulp plug-ins listed in the <a href="http;//gulpjs.com/plugins">official website</a>. Yet gulp is sensitive about plugins, that there should be one, if it is only necessary, and they have a <a href="https://github.com/gulpjs/plugins/blob/master/src/blackList.json">blacklist of plugins</a> that should not be used, so pick your plugins carefully, and use bare npm modules wherever possible. Also checkout the <a href="https://github.com/gulpjs/gulp/blob/master/docs/README.md">documentation</a> and <a href="https://github.com/gulpjs/gulp/tree/master/docs/recipes">recipes</a> for achieving various tasks.</p>

<h2>Conclusion</h2>

<p>In this article we have built a project template for Phaser using gulp as our build tool, and requirejs as our module loader. We have learned how to define gulp tasks and how to make use of gulp plug-ins to enable us a nice development environment, with watching files and live-reloading our changes. Note that yet we used Phaser as a sample project, this will give you the main idea, and hopefully you will apply the same principles to your specific projects. You can find the full source code at <a href="https://github.com/eguneys/phaser-gulp-requirejs">github</a>.</p>

<p>In the next article we will use this project template to build a yeoman generator, we will also show test driven development using mocha and yeoman test helpers.</p>
]]></content>
  </entry>
  
</feed>
